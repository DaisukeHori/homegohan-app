# ã»ã‚ã‚´ãƒãƒ³ - Cursor AI ãƒ«ãƒ¼ãƒ«

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
AIã‚’æ´»ç”¨ã—ãŸé£Ÿäº‹ç®¡ç†ãƒ»çŒ®ç«‹ææ¡ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
- Web: Next.js 14 (App Router)
- Mobile: Expo (React Native)
- Backend: Supabase (PostgreSQL, Edge Functions, Auth, Storage)
- AI: OpenAI GPT-5-mini, Google Gemini 2.0 Flash

## ä»•æ§˜æ›¸ã®å ´æ‰€
- **SPECIFICATION.md** - è©³ç´°ä»•æ§˜ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€APIã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰
- **DESIGN.md** - UI/UXãƒ‡ã‚¶ã‚¤ãƒ³
- **MOBILE_TODO.md** - ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã®é€²æ—

---

## ğŸ”§ MCPï¼ˆModel Context Protocolï¼‰ã§ã§ãã‚‹ã“ã¨

### Supabase MCP
AIãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨Edge Functionsã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€‚

**ä½¿ã„æ–¹ã®ä¾‹:**
- ã€Œapp_logsãƒ†ãƒ¼ãƒ–ãƒ«ã®æœ€æ–°ã‚¨ãƒ©ãƒ¼ã‚’è¦‹ã›ã¦ã€
- ã€Œgenerate-weekly-menu-v2ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ã€
- ã€Œä»Šæ—¥ã®APIã‚¨ãƒ©ãƒ¼ã‚’èª¿ã¹ã¦ã€
- ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼â—¯â—¯ã®çŒ®ç«‹ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ã€
- ã€ŒEdge Functionsã®ãƒ­ã‚°ã‚’è¦‹ã›ã¦ã€

**åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«:**
| ãƒ„ãƒ¼ãƒ« | èª¬æ˜ |
|--------|------|
| `list_tables` | ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ã‚’å–å¾— |
| `execute_sql` | SQLã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œ |
| `apply_migration` | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ |
| `get_logs` | Edge Functions/Auth/Storageç­‰ã®ãƒ­ã‚°ã‚’å–å¾— |
| `generate_typescript_types` | å‹å®šç¾©ã‚’ç”Ÿæˆ |

### Vercel MCP
- ãƒ‡ãƒ—ãƒ­ã‚¤ã€ãƒ­ã‚°ç¢ºèªã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢

### GitHub MCP
- Issueã€PRã€ã‚³ãƒ¼ãƒ‰æ¤œç´¢

---

## ğŸ“‹ app_logs ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰

Edge Functionsã€API Routesã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒ­ã‚°ã‚’ä¸€å…ƒç®¡ç†ã€‚

**ã‚ˆãä½¿ã†ã‚¯ã‚¨ãƒª:**
```sql
-- æœ€æ–°ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
SELECT * FROM app_logs WHERE level = 'error' ORDER BY created_at DESC LIMIT 20;

-- ç‰¹å®šã®é–¢æ•°ã®ãƒ­ã‚°
SELECT * FROM app_logs WHERE function_name = 'generate-weekly-menu-v2' ORDER BY created_at DESC LIMIT 50;

-- ä»Šæ—¥ã®ãƒ­ã‚°
SELECT * FROM app_logs WHERE created_at >= CURRENT_DATE ORDER BY created_at DESC;

-- ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°
SELECT * FROM app_logs WHERE user_id = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ID' ORDER BY created_at DESC LIMIT 30;
```

**ãƒ­ã‚°ãƒ˜ãƒ«ãƒ‘ãƒ¼:**
- Edge Functionsç”¨: `supabase/functions/_shared/db-logger.ts`
- Next.js APIç”¨: `src/lib/db-logger.ts`

---

## ğŸš€ Edge Functions

| é–¢æ•°å | ç”¨é€” |
|--------|------|
| `generate-weekly-menu-v2` | é€±é–“çŒ®ç«‹ç”Ÿæˆï¼ˆv2/ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆé§†å‹•ï¼‰ |
| `generate-single-meal-v2` | å˜ç™ºçŒ®ç«‹ç”Ÿæˆ |
| `regenerate-meal-direct-v2` | çŒ®ç«‹å·®ã—æ›¿ãˆ |
| `analyze-health-photo` | å¥åº·æ©Ÿå™¨å†™çœŸåˆ†æ |
| `generate-health-insights` | å¥åº·åˆ†æç”Ÿæˆ |

**ãƒ‡ãƒ—ãƒ­ã‚¤:**
```bash
npx supabase functions deploy <é–¢æ•°å> --project-ref flmeolcfutuwwbjmzyoz
```

---

## ğŸ› ï¸ é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

```bash
# Webé–‹ç™ºã‚µãƒ¼ãƒãƒ¼
npm run dev

# ãƒ¢ãƒã‚¤ãƒ«é–‹ç™º
cd apps/mobile && npx expo start

# Edge Functionsãƒ‡ãƒ—ãƒ­ã‚¤
npx supabase functions deploy <é–¢æ•°å> --project-ref flmeolcfutuwwbjmzyoz

# å‹ç”Ÿæˆ
npx supabase gen types typescript --project-id flmeolcfutuwwbjmzyoz > types/database.ts
```

---

## âš ï¸ æ³¨æ„äº‹é …

1. **ç§˜å¯†éµã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ç½®ã‹ãªã„**: `SUPABASE_SERVICE_ROLE_KEY`, `OPENAI_API_KEY`, `GOOGLE_*_API_KEY`
2. **v1/v2ã®åŒºåˆ¥**: Edge Functionsã«ã¯æ—§æ–¹å¼(v1)ã¨æ–°æ–¹å¼(v2)ãŒã‚ã‚‹ã€‚ç¾åœ¨ã¯v2ã‚’ä½¿ç”¨ã€‚
3. **RLSæœ‰åŠ¹**: å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã«Row Level SecurityãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã€‚

---

## ğŸ“¦ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
homegohan-app/
â”œâ”€â”€ apps/mobile/          # Expo (iOS/Android)
â”œâ”€â”€ packages/core/        # å…±æœ‰å‹/ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ src/                  # Next.js Web
â”‚   â”œâ”€â”€ app/              # App Router
â”‚   â”œâ”€â”€ components/       # ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ lib/              # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ functions/        # Edge Functions
â”‚   â””â”€â”€ migrations/       # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â””â”€â”€ types/                # å‹å®šç¾©
```
